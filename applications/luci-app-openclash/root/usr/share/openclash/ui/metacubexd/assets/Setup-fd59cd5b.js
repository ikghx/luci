import{R as F,a3 as z,a4 as A,U as N,N as P,i as d,c as h,O as q,F as H,d as C,a5 as x,v as U,e as M,w as O}from"./vendor-0f159d83.js";import{u as T,e as m,B as _,s as f,a as X,b as S,t as G}from"./index-26b8b771.js";let y;const J=new Uint8Array(16);function K(){if(!y&&(y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(J)}const l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));function Q(t,e=0){return l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]}const W=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),E={randomUUID:W};function Y(t,e,r){if(E.randomUUID&&!e&&!t)return E.randomUUID();t=t||{};const a=t.random||(t.rng||K)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){r=r||0;for(let c=0;c<16;++c)e[r+c]=a[c];return e}return Q(a)}const Z=C('<div class="mx-auto flex max-w-screen-sm flex-col items-center gap-4 py-10"><form class="contents"><div class="flex w-full flex-col gap-4"><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="url" type="url" class="input input-bordered w-full" placeholder="http://127.0.0.1:9090" list="defaultEndpoints"><datalist id="defaultEndpoints"><option value="http://127.0.0.1:9090"></option></datalist></div><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="secret" type="password" class="input input-bordered w-full" placeholder="secret"></div></div></form><div class="grid w-full grid-cols-2 gap-4">'),tt=C('<div class="badge badge-info flex w-full cursor-pointer items-center justify-between gap-4 py-4"><span class="truncate">'),et=x.object({url:x.string().nonempty(),secret:x.string()}),lt=()=>{const[t]=T(),e=F(),r=n=>{S(n),e("/overview")},a=(n,s)=>O.get(n,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then(({ok:i})=>i).catch(i=>{const{message:o}=i;U.error(o)}),c=async n=>{const s=m().find(i=>i.id===n);s&&await a(s.url,s.secret)&&r(n)},b=async({url:n,secret:s})=>{const i=G(n);if(!await a(i,s))return;const o=Y(),u=m().slice(),p=u.find(v=>v.url===i);if(!p){f([{id:o,url:i,secret:s},...u]),r(o);return}p.secret=s,p.id=o,f(u),r(o)},R=n=>{const{message:s}=n;U.error(s)},{form:w}=z({extend:A({schema:et}),onSubmit:b,onError:R}),I=n=>{X()===n&&S(""),f(m().filter(s=>s.id!==n))};return N(()=>{const n=new URLSearchParams(window.location.search);n.has("hostname")?b({url:`${window.location.protocol}//${n.get("hostname")}${n.get("port")?`:${n.get("port")}`:""}`,secret:n.get("secret")??""}):m().length===0&&b({url:"http://127.0.0.1:9090",secret:""})}),(()=>{const n=Z(),s=n.firstChild,i=s.firstChild,o=i.firstChild,u=o.firstChild,p=u.firstChild,v=o.nextSibling,L=v.firstChild,k=L.firstChild,D=s.nextSibling;return P(w,s,()=>w),d(p,()=>t("endpointURL")),d(k,()=>t("secret")),d(i,h(_,{type:"submit",class:"btn-primary uppercase",get children(){return t("add")}}),null),d(D,h(H,{get each(){return m()},children:({id:$,url:V})=>(()=>{const g=tt(),j=g.firstChild;return g.$$click=()=>c($),d(j,V),d(g,h(_,{class:"btn-circle btn-ghost btn-xs text-white",onClick:B=>{B.stopPropagation(),I($)},get children(){return h(q,{})}}),null),g})()})),n})()};M(["click"]);export{lt as default};
